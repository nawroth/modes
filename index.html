<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>modes.nawroth.se</title>
<link rel="stylesheet"
	href="http://code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css" />
<script
	src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script
	src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js"></script>

<style type="text/css">
</style>
<script type="text/javascript">
  $( function()
  {
    var keysSharp = [ "C", "C♯", "D", "D♯", "E", "F", "F♯", "G", "G♯", "A", "A♯", "B" ], keysFlat = [ "C", "D♭", "D",
        "E♭", "E", "F", "G♭", "G", "A♭", "A", "B♭", "B" ], modes = [ "Ionian", "Dorian", "Phrygian", "Lydian",
        "Mixolydian", "Aeolian", "Locrian" ], modeIntervals = [ 0, 2, 4, 5, 7, 9, 11 ];
    var keys = keysFlat;

    function setOptions(select, collection, transformer)
    {
      var selected = select[0].selectedIndex;
      if ( selected === -1 )
      {
        selected = 0;
      }
      select.empty();
      $( collection ).each( function(index, value)
      {
        if ( typeof ( transformer ) === "function" )
        {
          value = transformer( index, value );
        }
        var option = $( "<option />" ).text( value ).appendTo( select );
        if ( index === selected )
        {
          option.attr( "selected", "selected" );
        }
      } );
    }

    function setEquivalentOptions(select, keyIndex, modeIndex)
    {
      setOptions( select, modes, function(index, value)
      {
        var interval = modeIntervals[index] - modeIntervals[modeIndex] + keyIndex + 12;
        interval %= 12;
        return value + " " + keys[interval];
      } );
    }

    function createChord(parent)
    {
      var wrapper = $( "<div class='item'/>" );
      wrapper.appendTo( parent );
      var key = $( "<select class='key'/>" );
      key.appendTo( wrapper );
      var mode = $( "<select class='mode'/>" );
      mode.appendTo( wrapper );
      setOptions( mode, modes );
      var equivalent = $( "<select class='equivalent'/>" );
      equivalent.appendTo( wrapper );

      var updater = function updateEquivalents()
      {
        setOptions( key, keys );
        setEquivalentOptions( equivalent, $( key )[0].selectedIndex, $( mode )[0].selectedIndex );
      };
      updater();
      key.change( updater );
      mode.change( updater );

      wrapper[0]["update"] = updater;
    }

    function prepareCpanel(parent)
    {
      $( "#add" ).button().click( function()
      {
        createChord( $( "#items" ) );
      } );

      $( "#sharpflat" ).buttonset().change( function()
      {
        keys = $( "#flat" )[0].checked ? keysFlat : keysSharp;
        $( ".item" ).each( function()
        {
          this.update();
        } );
      } );
    }
    prepareCpanel( $( "#cpanel" ) );
  } );
</script>

</head>
<body>
	<div id="cpanel">
		<button id="add">Add</button>
		<div id="sharpflat">
			<input type="radio" value="Flat" id="flat" checked="checked"
				name="sharpflatbutton" /> <label for="flat">♭</label> <input
				type="radio" value="Sharp" id="sharp" name="sharpflatbutton" /> <label
				for="sharp">♯</label>
		</div>
	</div>
	<div id="items"></div>
</body>
</html>